# Подглава 11.13 Тестирование MoveIt! в демонстрационном режиме

MoveIt! пакет конфигурации, который мы только что создали, включает файл `demo.launch`, который позволит нам протестировать установку. Запустите следующую команду, чтобы запустить все MoveIt! узлы и сервисы в демонстрационном режиме:

```text
$ roslaunch pi_robot_moveit_config demo.launch
```

ПРИМЕЧАНИЕ. Если файл запуска демо-версии прерывается, введите Ctrl-C и повторите попытку запуска. Если он продолжает падать, виновником, скорее всего, является RViz. Отключение аппаратного ускорения для RViz обычно помогает, это можно сделать, выполнив следующую команду перед запуском файла demo.launch:

```text
$ export LIBGL_ALWAYS_SOFTWARE=1
```

Если это решает проблему сбоя, возможно, было бы неплохо поместить указанную выше команду в конец файла `~/.bashrc`, чтобы она автоматически запускалась в новых сеансах терминала.

Как только RViz появится успешно, вы должны увидеть Pi Robot на правой панели и панель **Motion Planning** слева, как показано ниже:

![](.gitbook/assets/image%20%2821%29.png)

Подтвердите или измените настройки в RViz, чтобы они соответствовали следующему:

* Global Option → **Fixed Frame:** base\_footprint
* **Motion Planning** → **Scene Robot** → поставьте флажок **Show Robot Visual**
* **Motion Planning** → **Planning Request** → **Planning Group →** right\_arm
* **Motion Planning** → **Planning Request** → поставьте флажок **Query Start State**
* **Motion Planning** → **Planning Request** → поставьте флажок **Query Goal State**
* **Motion Planning** → **Planned Path** → поставьте флажок **Show Robot Visual**
* **Motion Planning** → **Planned Path** → снимите флажок **Loop Animation**
* **Motion Planning** → **Planned Path** → снимите флажок **Show Trail**
* **File** → **Save Config**

Теперь вы можете попробовать установить цели навигации для робота Pi. Для полного описания того, как сделать это с помощью интерактивных маркеров, см. Краткое руководство по MoveIt! Wiki. Ниже приводится краткое изложение шагов. Обратите внимание, что по умолчанию начальная конфигурация руки показана зеленым, а целевая конфигурация оранжевым.

* Перейдите на вкладку **Context** на панели **Motion Planning** и убедитесь, что флажок **Use Collision-Aware IK** установлен, как показано ниже:

![](.gitbook/assets/image%20%2816%29.png)

* Затем нажмите на вкладку **Planning** на панели **Motion Planning**, и вы должны увидеть следующий экран:
* 
![](.gitbook/assets/image%20%2823%29.png)

Нажмите **Select Start State** в столбце **Query**. В большинстве случаев вы просто оставляете это `<current>`, но вы также можете использовать выпадающее меню, чтобы выбрать другую начальную конфигурацию руки. Если вы определили некоторые именованные позы для руки при запуске Setup Assistant, они будут перечислены в меню. Вы также можете выбрать случайную конфигурацию руки. Когда вы сделали свой выбор, нажмите кнопку **Update**. Начальная конфигурация будет отображаться как зеленая рука в RViz. \(Если начальная конфигурация `<current>`, зеленый цвет, вероятно, будет скрыт под нормальным отображением руки.\) Вы также можете использовать интерактивные маркеры на конце руки, чтобы установить начальную позицию с помощью мыши. Обратите внимание, что при использовании интерактивных маркеров вы не нажимаете кнопку **Update**, когда закончите установку рычага.

* После того, как вы установили начальную конфигурацию, нажмите **Select Goal State** в столбце **Query**. Используйте выпадающее меню, чтобы выбрать целевую конфигурацию руки, затем нажмите кнопку **Update**. Конфигурация цели будет отображаться как оранжевая рука в RViz. Изображение ниже показывает, что мы выбрали конфигурацию "straight\_forward":

![](.gitbook/assets/image%20%284%29.png)

Кроме того, вы можете использовать интерактивные маркеры на руке оранжевого цвета, чтобы установить позицию цели. Как отмечалось ранее, при использовании интерактивных маркеров вы не нажимаете кнопку **Update**, когда заканчиваете позиционирование рычага. \(Вы также можете выбрать предопределенную позу, нажать **Update**, а затем настроить позу с помощью интерактивных маркеров.\)

Когда вы будете удовлетворены начальным и целевым состояниями, нажмите кнопку **Plan and Execute.** Рука должна двигаться между начальной и целевой конфигурациями.

Возможно, вам будет полезно выбрать несколько состояний `<random valid>` для **Goal** **State**, которые дадут вам представление о диапазоне и типах траекторий, ожидаемых от вашей руки.

Чтобы выйти из демонстрационного режима, введите Ctrl-C в окне терминала, в котором вы запустили файл `demo.launch`.

