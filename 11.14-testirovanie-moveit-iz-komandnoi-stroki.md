# Подглава 11.14 Тестирование MoveIt! из Командной Строки

Чтобы проверить основные функциональные возможности нашего манипулятора, мы можем взаимодействовать с MoveIt! из командной строки с помощью утилиты `moveit_commander_cmdline.py`. Если у вас еще не запущен файл MoveIt! `demo.launch`, запустите его сейчас:

```text
$ roslaunch pi_robot_moveit_config demo.launch
```

Затем снимите флажки с **Query Start State** и **Query Goal State** следующим образом:

* **Motion Planning** → **Planning Request** → снимите флажок **Query Start State**
* **Motion Planning** → **Planning Request** → снимите флажок **Query Goal State**

С этими настройками мы можем более легко просматривать движение руки при отправке команд движения в MoveIt! motion planner.

Теперь поднимите MoveIt! интерфейс командной строки, запустив:

```text
$ rosrun moveit_commander moveit_commander_cmdline.py
```

Вы должны быть увидеть в командной строке:

```text
Waiting for commands. Type 'help' to get a list of known commands.
> 
```

Все команды в MoveIt! работают с группой перемещения, как определено в файлах конфигурации для используемого робота. В случае с Pi Robot, сначала выберите группу `right_arm` с помощью команды `use`:

```text
> use right_arm
```

После небольшой задержки вы должны увидеть вывод, похожий на следующий, и новую командную строку для группы `right_arm`:

```text
[ INFO] [1369528317.243702965]: Ready to take MoveGroup commands for group right_arm.
OK right_arm>
```

С роботом, видимым в RViz, мы начнем с перемещения руки к произвольному набору углов joints с помощью команды `go rand`: 

```text
right_arm> go rand
```

MoveIt! проверит правильность выбранных углов относительно кинематической модели руки. Целевая поза будет считаться недействительной, если \(1\) выбранные углы joints выходят за пределы joint, установленные в модели, \(2\) рука столкнется с другой частью робота, такой как голова или туловище, или \(3\) движение заставит руку ударить любые близлежащие объекты. \(Подробнее об этом позже.\) Если любая из этих проверок не пройдена, появится сообщение, подобное следующему:

```text
[ INFO] [1369529066.236768000]: ABORTED: No motion plan found. No execution attempted.
Failed while moving to random target [-0.785861312784 -0.777854562622 -1.90569032181 -0.927753414307 -0.32391361976 0.711703415429]
```

Если цель представляет собой достижимую конфигурацию руки, MoveIt! запланирует траекторию от начальной конфигурации до целевой конфигурации и передаст эту траекторию на контроллер траектории манипулятора. Затем контроллер плавно переместит руку в новое положение. В этом случае вы увидите вывод, подобный следующему:

```text
right_arm> go rand
Moved to random target [-1.33530406365 0.898460602916 0.184664419448 1.20867797686 0.171914381348 1.08589163089]
right_arm>
```

Попробуйте ввести команду `go rand` несколько раз, чтобы увидеть, как рука реагирует на различные целевые конфигурации.

Давайте рассмотрим несколько других команд. Чтобы увидеть текущие совместные значения и положение end-effector, используйте команду `current`:

```text
right_arm> current
```

Вывод должен выглядеть примерно так:

```text
joints = [0.0135323487558 0.544921628281 2.26598694909 0.598703264228 -0.8361580286
1.32167751045]
right_gripper_link pose =
[ header: seq: 0 stamp:
secs: 1369490199 nsecs:
690589904 frame_id: odom
pose: position: x:
0.0117037066685 y: -
0.197628755962 z:
0.537961695072
orientation:
x: 0.182884025394
y: 0.0589242746894
z: -0.764116809095
w: 0.615797746964 ]
right_gripper_link RPY = [0.14494326196452958, 0.3597715164230441, -1.7585397976479231]
```

В верхней части вывода мы видим список углов joint в радианах. Joints перечислены в том же порядке, как они связаны в руке, начиная с плеча и по направлению к gripper. Затем следует поза \(положение и ориентация\) end-effector \(gripper\) относительно frame `/odom`. В конце выходных данных указана ориентация end-effector в виде крена, тангажа и рысканья \(RPY\) вокруг осей x, y и z соответственно.

Чтобы записать текущую конфигурацию в переменную с именем '`c`', используйте команду:

```text
right_arm> record c
Remembered current joint values under the name c right_arm>
```

Значения целевого соединения теперь можно настроить с помощью соответствующего индекса. Например, чтобы установить второе совместное значение равным `0.2`, используйте команду: 

```text
right_arm> c[1] = 0.2
```

Чтобы установить цель для измененной конфигурации, используйте команду:

```text
right_arm> goal = c
```

Наконец, чтобы переместить руку в новую конфигурацию цели, убедитесь, что робот виден в RViz, затем отправьте цель в руку, используя команду:

```text
right_arm> go goal
```

Помните, что новая цель может потерпеть неудачу, если она не пройдет все проверки, описанные ранее.

Если вы определили одну или несколько именованных поз в Setup Assistant, вы можете использовать их в Commander. Для робота Pi вы можете отправить позу "resting", "straight\_forward" или "wave":

```text
right_arm> go resting
right_arm> go straight_forward
right_arm> go wave
```

Чтобы увидеть другие команды, поддерживаемые MoveIt! Commander, введите help в командной строке:

```text
right_arm> help
```

Теперь, когда мы знаем, как MoveIt! общается с рукой, пришло время заставить ее сделать что-то полезное.

